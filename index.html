<!DOCTYPE html>
<html lang="en">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

function setExampleCESP() {
    document.getElementById('input').value = "10009632, Fulano de Tal, 53.50, 13.33 / 10009533, José das Medalhas, 50.28, 13.2 / 10009532, Maria da Silva, 48.5, 12.23 / 10009420, Quentin Tarantino, 33.12, 13.9 / 10009620, Walter Cunha, 32.00, 11.11 / 10009430, Bob Maconel, 60.00, 13.27 / 10009618, Fernando Pedrosa, 60.90, 12.6 / 10009633, Kim Jong-un, 99.97, 15 / 10009534, Vladimir Putin, 61.18, 11.8 / 10009705, William Jefferson Clinton, 61.18, 11.99";

    document.getElementById('ModeloSelecionado').innerHTML = "CESP";
}


function setExampleCESGRANRIO() {
    document.getElementById('input').value = "Bob Sponja; 010000509-8; 36; 1; 14/Fulano de Tal; 010000205-6; 35; 2; 23/José das Medalhas; 010000343-5; 34; 3; 73/Jacky Mao; 010000411-3; 33; 4; 90/Quatin Tarantino; 010000256-0; 33; 5; 101/Papai Noel; 010000447-4; 32; 6; 102/Fernando H. Cardoso; 010000309-5; 32; 7; 103/Batman; 010000179-3; 32; 8; 104/Fernanda Montenegro; 010000342-7; 32; 9; 105/Silvio Santos; 010000482-2; 32; 10; 106/Pablo do Qual é a Musica; 010000659-0; 32; 11; 108/Aluno da USP; 010000460-1; 31; 12; 109/Chico Buarque; 010000368-0; 31; 13; 110/Um Dois de Oliveira; 010000478-4; 31; 14; 111";

    document.getElementById('ModeloSelecionado').innerHTML = "CESGRANRIO";
}

function Tabber(str, total) {
    // Retorna o texto com espaços à direita, até o total.
    var ret = typeof str == 'string' ? str : str.toString();
    for(var i = ret.length; i < total; ++i) ret += ' ';
    return ret;
}
function Pad(num, total) {
    // Retorna o número com zeros à esquerda, até o total.
    var zero = total - num.toString().length + 1;
    return Array(+(zero > 0 && zero)).join('0') + num;
}
function PegaCamposOrdenadores() {
    var ret = [ $('#ordenador').val(), $('#ordenador2').val() ];
    if(ret[0].length == 0 || isNaN(ret[0])) { // validação do primeiro campo de ordenação
        alert('O campo de ordenação deve ser um valor numérico.');
        $('#ordenador').select();
        return null;
    }
    ret[0] = parseInt(ret[0]);
    if(ret[1].length > 0) { // validação do segundo campo de ordenação
        if(isNaN(ret[1])) {
            alert('O segundo campo de ordenação deve ser um valor numérico,\n' +
                'ou deixe em branco se ele não for necessário.');
            $('#ordenador2').select();
            return null;
        }
        ret[1] = parseInt(ret[1]);
    }
    if(ret[0] == ret[1]) {
        alert('Os campos de ordenação são iguais.\nIsso não faz muito sentido, não é?');
        $('#ordenador2').select();
        return null;
    }
    return ret;
}
function CriaCampoSomatorio(data) {
    var somadores = $('#somadores').val();
    if(somadores.length == 0) return true;
    somadores = somadores.split(',');
    for(var i = 0; i < somadores.length; ++i) { // validação dos campos para o somatório
        if(isNaN(somadores[i])) {
            alert('Digite os números dos campos a serem somados para formar um novo campo, ' +
                'ou deixe em branco caso um somatório não seja necessário.');
            return false;
        }
        somadores[i] = parseInt(somadores[i]);
        if(somadores[i] > data[0].length) {
            alert('O último campo de ordenação é ' + data[0].length + ', ' +
                'não existe um campo ' + somadores[i] + ' para somar.');
            $('#somadores').select();
            return false;
        }
    }
    for(var i = 0; i < data.length; ++i) {
        data[i].push(0); // cria o campo extra
        for(var j = 0; j < somadores.length; ++j)
            data[i][data[i].length - 1] += data[i][somadores[j] - 1]; // soma cada campo
    }
    return true;
}

function FormataSaida(data) {
    var output = '';

    var modelo = document.getElementById('ModeloSelecionado').innerHTML;

    if (modelo == 'CESP') {
        if($('#csv').val() == 'txt') {
            var longestNameLen = 0; // quantidade de caracteres do candidato com nome mais comprido
            for(var i = 0; i < data.length; ++i) { // para cada entrada
                if(data[i][1].length > longestNameLen)
                    longestNameLen = data[i][1].length;
            }
        
            for(var i = 0; i < data.length; ++i) {
                output += Pad(i + 1, data.length.toString().length) + ' ' // ordem numérica
                + Tabber(data[i][1], longestNameLen + 1); // nome do candidato
                for(var j = 2; j < data[i].length; ++j)
                    output += Tabber(data[i][j].toFixed(2), 7); // demais valores
                output += '\n';
            }
        } else {
            for(var i = 0; i < data.length; ++i) {
                output += (i + 1) + ',' // ordem numérica
                    + data[i][1] + ',' // nome do candidato
                for(var j = 2; j < data[i].length; ++j)
                    output += data[i][j].toFixed(2) + ','; // demais valores
                output = output.substr(0, output.length - 1) + '\n';
            }
        }
        $('#output').val(output);
    } else {


        if($('#csv').val() == 'txt') {
            var longestNameLen = 0; // quantidade de caracteres do candidato com nome mais comprido
            for(var i = 0; i < data.length; ++i) { // para cada entrada
                if(data[i][0].length > longestNameLen)
                    longestNameLen = data[i][0].length;
            }
        
            for(var i = 0; i < data.length; ++i) {
                output += Pad(i + 1, data.length.toString().length) + ' ' // ordem numérica
                + Tabber(data[i][0], longestNameLen + 1); // nome do candidato
                for(var j = 2; j < data[i].length; ++j)
                    output += Tabber(data[i][j].toFixed(2), 7); // demais valores
                output += '\n';
            }
        } else {
            for(var i = 0; i < data.length; ++i) {
                output += (i + 1) + ',' // ordem numérica
                    + data[i][0] + ',' // nome do candidato
                for(var j = 2; j < data[i].length; ++j)
                    output += data[i][j].toFixed(2) + ','; // demais valores
                output = output.substr(0, output.length - 1) + '\n';
            }
        }
        $('#output').val(output);
    }    
}
$(document).ready(function() {
    $('#vai').submit(function() {
        var campoOrd = PegaCamposOrdenadores();
        if(campoOrd === null) return false;
        var data = $('#input').val(); // texto bruto com entradas separadas por barra
        data = data.replace(/\n/g, ' ') // retira quebras de linha
            .replace(/\;/g, ',')
            .replace(/\//g, '\n')       // transforma as barras em quebras de linha; uma entrada por linha
            .replace(/\;/g, '\n')       // transforma as ponto e virgula em quebras de linha; uma entrada por linha
            .split('\n');               // agora temos um array com as entradas
        for(var i = 0; i < data.length; ++i) { // para cada entrada
            data[i] = data[i].split(','); // um array com os campos
            for(var j = 0; j < data[i].length; ++j) {
                data[i][j] = data[i][j].trim(); // trim em cada campo
                if(!isNaN(data[i][j]))
                    data[i][j] = parseFloat(data[i][j]);
            }
        }
        if(!CriaCampoSomatorio(data)) return false;
        if(campoOrd[0] > data[0].length || campoOrd[1] > data[0].length) { // valida campos de ordenação
            alert('O último campo de ordenação é ' + data[0].length + ', não ' +
                (campoOrd[0] > data[0].length ? campoOrd[0] : campoOrd[1]) + '.');
            $(campoOrd[0] > data[0].length ? '#ordenador' : '#ordenador2').select();
            return false;
        }
        
        data.sort(function(a, b) {
            if(campoOrd[1].length != '') {
                return b[campoOrd[0] - 1] != a[campoOrd[0] - 1] ?
                    b[campoOrd[0] - 1] - a[campoOrd[0] - 1] :
                    b[campoOrd[1] - 1] - a[campoOrd[1] - 1];
            } else {
                return b[campoOrd[0] - 1] - a[campoOrd[0] - 1]; // decrescente
            }
        });
        FormataSaida(data);

        document.getElementById('about').scrollIntoView();   
        window.setTimeout( 2000 );
        return false;
    });

     
});
</script>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Ordenador de arquivo de texto" content="">
    <meta name="Joao Antonio" content="">

    <title>Ordenador de Textos</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/scrolling-nav.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<!-- The #page-top ID is part of the scrolling feature - the data-spy and data-target are part of the built-in Bootstrap scrollspy function -->

<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">Ordenador de Textos</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden">
                        <a class="page-scroll" href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#contato">Contato</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Intro Section -->
    <section id="intro" class="intro-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1>Ordenador de Textos</h1>
                    <p><strong>Ordenador de Resultados:</strong> Entre com o texto a ser ordenado. Caso tenha dúvidas quanto a entrada do texto utilize um dos modelos abaixo</p>

                    <button onclick="setExampleCESP()">Modelo CESP</button>
                    <button onclick="setExampleCESGRANRIO()">Modelo CESGRANRIO</button>

                    <p></p>
                    <textarea id="input" rows="14" cols="110"></textarea><br/>
                    <form id="vai"><p>Criar campo extra somando os campos <input type="text" id="somadores" size="10" value="3,4"/> (separe-os por vírgula)<br/>Ordenar pelo campo <input type="text" id="ordenador" size="2" value="3"/>e depois pelo campo <input type="text" id="ordenador2" size="2"/>, gerar
                        <select id="csv"><option value="txt">texto plano</option><option value="csv">CSV</option></select>
                    
                    <p>Modelo selecionado:</p>
                    <label id="ModeloSelecionado">CESP</label>
                    <p></p>
                    <input type="submit" href="#about" value="Processar"/>
                    </p></form>
                    
                </div>
            </div>
        </div>
    
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1>Saída</h1>
                    <textarea id="output" rows="14" cols="80"></textarea><p></p>
                    <a class="btn btn-default page-scroll" href="#page-top" input type="submit" value="Processar">Nova entrada de texto</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="contato" class="services-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1>Contato</h1>
                    <p>Olá, eu fiz essa aplicação porque o meu irmão me pediu. Espero que lhe seja útil. :)</p>
                    <p><i>O código fonte deste script é livre:
                    <a target="_blank" href="http://joaoapaenas.github.io/ordenar-texto/">joaoapaenas.github.io/ordenar-texto/</a></i></p>
                </div>
            </div>
        </div>
    </section>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Scrolling Nav JavaScript -->
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/scrolling-nav.js"></script>

</body>

</html>
